
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>記帳小幫手</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #f4f4f4;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
        button {
            margin: 5px;
            padding: 10px 15px;
        }
        input, select, textarea {
            display: block;
            margin: 10px 0;
            padding: 8px;
            width: 100%;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <h1>記帳小幫手</h1>
    <form id="accountForm">
        <div id="step1" class="step active">
            <p>請選擇類型：</p>
            <button type="button" onclick="selectType('支出')">支出</button>
            <button type="button" onclick="selectType('收入')">收入</button>
        </div>

        <div id="step2" class="step">
            <p>請選擇類別：</p>
            <select id="category" required></select>
            <button type="button" onclick="goToStep(3)">下一步</button>
        </div>

        <div id="step3" class="step">
            <label>金額：</label>
            <input type="number" id="amount" required />
            <button type="button" onclick="goToStep(4)">下一步</button>
        </div>

        <div id="step4" class="step">
            <label>註記：</label>
            <textarea id="note" placeholder="可選填"></textarea>
            <label>支付方式：</label>
            <input type="text" id="payment" placeholder="例如 現金 / 信用卡" />
            <label>地點：</label>
            <input type="text" id="location" placeholder="例如 便利商店 / 餐廳" />
            <button type="submit">送出</button>
        </div>
    </form>

    <p id="status"></p>

    <script>
        const form = document.getElementById('accountForm');
        let selectedType = "";
        const categoryMap = {
            '支出': ['餐飲', '交通', '購物', '娛樂', '醫療', '其他'],
            '收入': ['薪資', '獎金', '投資', '其他']
        };

        function selectType(type) {
            selectedType = type;
            const category = document.getElementById('category');
            category.innerHTML = '';
            categoryMap[type].forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                category.appendChild(option);
            });
            goToStep(2);
        }

        function goToStep(step) {
            document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
        }

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            const data = {
                type: selectedType,
                category: document.getElementById('category').value,
                amount: document.getElementById('amount').value,
                note: document.getElementById('note').value,
                payment: document.getElementById('payment').value,
                location: document.getElementById('location').value,
                timestamp: new Date().toLocaleString("zh-TW")
            };

            document.querySelector('button[type="submit"]').disabled = true;
            document.getElementById('status').innerText = '送出中...';

            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycbxliXcj0nQzOj65S19qMGZY-L-_2aoc9uxLYwmWDLYP7w5gY5ccza1ILMDDcwtFf8JDlg/exec', {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                if (response.ok) {
                    document.getElementById('status').innerText = '✅ 記帳成功！';
                    form.reset();
                    goToStep(1);
                } else {
                    throw new Error("送出失敗");
                }
            } catch (error) {
                document.getElementById('status').innerText = '❌ 發生錯誤，請稍後再試';
            } finally {
                document.querySelector('button[type="submit"]').disabled = false;
            }
        });
    </script>
</body>
</html>
